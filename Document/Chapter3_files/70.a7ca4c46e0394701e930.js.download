(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{"9oVN":function(t,e,n){"use strict";n.d(e,"l",(function(){return r})),n.d(e,"p",(function(){return l})),n.d(e,"h",(function(){return a})),n.d(e,"g",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"d",(function(){return h})),n.d(e,"b",(function(){return f})),n.d(e,"o",(function(){return m})),n.d(e,"i",(function(){return d})),n.d(e,"n",(function(){return y})),n.d(e,"c",(function(){return b})),n.d(e,"e",(function(){return p})),n.d(e,"k",(function(){return g})),n.d(e,"m",(function(){return _})),n.d(e,"f",(function(){return v})),n.d(e,"a",(function(){return C}));var o=n("G4qV"),r=function(t){return t.symbolLists.lists},s=function(t){return t.widgets},i=function(t,e){return e},l=Object(o.a)([s,i],(function(t,e){return t[e]||{}})),a=Object(o.a)(l,(function(t){return t.selectedSymbols||[]})),c=Object(o.a)(l,(function(t){return t.scrollToId})),u=Object(o.a)(l,(function(t){return t.sorting||null})),h=Object(o.a)(l,(function(t){return t.highlightedSymbols||null})),f=Object(o.a)(l,(function(t){return t.columns})),m=Object(o.a)(l,(function(t){return t.options||{}})),d=Object(o.a)([m,function(t){return t.isAuthenticated}],(function(t,e){return t.shouldDisplayPositions&&e})),y=Object(o.a)(r,(function(t){return Object.values(t).filter((function(t){return void 0!==t&&!t.isHotlist}))})),b=Object(o.a)([r,s,i],(function(t,e,n){var o=e[n];if(void 0===o)return null;var r=o.listId;return null===r?null:t[r]||null})),p=Object(o.a)([l,b],(function(t,e){return null===e||t.isLoading||!1})),g=Object(o.a)([r,function(t,e){return e}],(function(t,e){return t[e]})),_=Object(o.a)(b,(function(t){return null!==t?t.symbols:[]})),v=Object(o.a)([function(t){return t.positions},function(t,e){return e}],(function(t,e){return t[e]})),C=function(t){return t.activeSymbolList}},G4qV:function(t,e,n){"use strict";function o(t,e){return t===e}function r(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var o=e.length,r=0;r<o;r++)if(!t(e[r],n[r]))return!1;return!0}function s(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var n=e.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return e}n.d(e,"a",(function(){return i}));var i=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return function(){for(var e=arguments.length,o=Array(e),r=0;r<e;r++)o[r]=arguments[r];var i=0,l=o.pop(),a=s(o),c=t.apply(void 0,[function(){return i++,l.apply(null,arguments)}].concat(n)),u=t((function(){for(var t=[],e=a.length,n=0;n<e;n++)t.push(a[n].apply(null,arguments));return c.apply(null,t)}));return u.resultFunc=l,u.dependencies=a,u.recomputations=function(){return i},u.resetRecomputations=function(){return i=0},u}}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=null,s=null;return function(){return r(e,n,arguments)||(s=t.apply(null,arguments)),n=arguments,s}}))},
"p+vD":function(t,e,n){"use strict";n.r(e),n.d(e,"getAllWatchLists",(function(){return c})),n.d(e,"getColoredWatchLists",(function(){return u})),n.d(e,"getCustomWatchLists",(function(){return h})),n.d(e,"getSymbols",(function(){return f})),n.d(e,"renameWatchList",(function(){return m})),n.d(e,"removeWatchList",(function(){return d})),n.d(e,"addSymbols",(function(){return y})),n.d(e,"removeSymbols",(function(){return b})),n.d(e,"replaceSymbols",(function(){return p})),n.d(e,"createWatchList",(function(){return g})),n.d(e,"exportList",(function(){return _})),n.d(e,"setActive",(function(){return v})),n.d(e,"getActive",(function(){return C}));var o=n("mrSG"),r=n("Eyy1"),s=n("BHQF"),i=n("AXL+");function l(t){var e=Object(o.__assign)({},t);return e.title=e.name,delete e.name,Object(o.__assign)(Object(o.__assign)({},e),{id:"colored"===e.type?Object(r.ensureNotNull)(e.color):e.id,isHotlist:!1})}function a(t){return t.ok?t.json():t.json().then((function(t){throw new Error(t.detail||"not ok")}))}function c(){return Object(s.fetch)("/api/v1/symbols_list/all/",{credentials:"include"}).then(a).then((function(t){return t.filter((function(t){return t.symbols.length>0}))})).then((function(t){return t.map(l)}))}function u(){return Object(s.fetch)("/api/v1/symbols_list/colored/",{credentials:"same-origin"}).then(a).then((function(t){return t.map(l)}))}function h(){return Object(s.fetch)("/api/v1/symbols_list/custom/",{credentials:"same-origin"}).then(a).then((function(t){return t.map(l)}))}function f(t){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{credentials:"same-origin"}).then(a)}function m(t,e){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/rename/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify({name:e}),headers:{"Content-Type":"application/json"}}).then(a)}function d(t){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{method:"DELETE",credentials:"same-origin"})}function y(t,e){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/append/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(a)}function b(t,e){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/remove/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(a)}function p(t,e){return 0===e.length&&"colored"===t.type?d(t):Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/replace/?unsafe=true",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(a)}function g(t){var e=Object(o.__assign)(Object(o.__assign)({},t),{name:t.title});return delete e.title,Object(s.fetch)("/api/v1/symbols_list/custom/",{method:"POST",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(a).then(l)}function _(t){Object(i.saveTextFile)(t.title+".txt",t.symbols.join(","))}function v(t){return Object(s.fetch)("/api/v1/symbols_list/active/"+t+"/",{method:"POST",
credentials:"same-origin"})}function C(){return Object(s.fetch)("/api/v1/symbols_list/active/",{method:"GET",credentials:"same-origin"}).then(a).then(l)}},tEuG:function(t,e,n){"use strict";n("bSeV");var o,r=n("YFKU"),s=n("mrSG"),i=n("Eyy1"),l=n("BHQF"),a=n("p+vD"),c=n("uOxu"),u=Object(c.getLogger)("MarkedSymbols.Api"),h=function(){function t(){}return t.prototype.getColoredLists=function(){return Object(a.getColoredWatchLists)()},t.prototype.removeSymbols=function(t,e){return 0===e.length?Promise.resolve():(u.logNormal("Sending request to remove symbols from "+t+"-list: "+e),Object(l.fetch)("/api/v1/symbols_list/colored/"+t+"/remove/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}))},t.prototype.addSymbols=function(t,e){return 0===e.length?Promise.resolve():(u.logNormal("Sending request to add/move symbols to "+t+"-list: "+e),Object(l.fetch)("/api/v1/symbols_list/colored/"+t+"/append/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}))},t}(),f=n("FBuY"),m=n("TxTq"),d=n.n(m),y=n("PfBM"),b=n("dm8g"),p=(n("iKPL"),n("J/x9")),g=n("9oVN"),_=n("ehHn"),v=n("IWXC"),C=Object(c.getLogger)("MarkedSymbols.Model"),S=["red","blue","green","orange","purple"],O=null,j=function(){function t(t){var e=this;this._promise=Object(p.a)(),this._service=null,this._symbols=new Map,this._changed=new Set,this._diff=new Map,this._names={},this._onCrossTabChange=function(t){C.logNormal("Cross tab sync"),JSON.parse(t).forEach((function(t){e._setSymbolColor(t.name,t.color)})),e._onListChange(!0)},this._onPushStreamChange=function(t){window.user&&window.user.session_hash!==t&&(C.logNormal("Cross browser sync"),e.syncSymbols())},this._onPushStreamStatus=function(t){t===y.ConnectionStatus.Open&&O===y.ConnectionStatus.Closed?(window.is_authenticated&&(o=setTimeout((function(){C.logNormal("Reconnect sync"),e.syncSymbols()}),30*Math.random()*1e3+3e4)),O=t):t===y.ConnectionStatus.Closed&&(O=t,clearTimeout(o))},this._opts=t,this._api=t.api||new h,this._session=t.quoteSession||Object(v.getQuoteSessionInstance)("simple"),this._promise.then((function(t){return e._service=t})),this.connect()}return t.prototype.getSymbolsByColor=function(t){if(null===this._service)return[];var e=this._service.store.getState(),n=Object(g.k)(e,t);return n?n.symbols:[]},t.prototype.getLists=function(){var t=this;return S.reduce((function(e,n){return e.set(n,new Set(t.getSymbolsByColor(n))),e}),new Map)},t.prototype.setSymbolsColor=function(t,e){var n=this;C.logNormal("Set symbols color "+e);try{t.forEach((function(t){n._setSymbolColor(t,e)}))}finally{this._onListChange()}},t.prototype.getSymbolColor=function(t){var e=this._symbols.get(t);return e?e.color:null},t.prototype.clearAllSymbolsColor=function(){C.logNormal("Clear all symbols color");var t=Array.from(this._symbols.keys());this.setSymbolsColor(t,null),this._clearStore()},t.prototype.syncSymbols=function(){var t=this;return Promise.all([this._api.getColoredLists(),this._promise]).then((function(e){
var n=e[0];return t._ensureConsistency(n)})).then((function(e){t._names={};for(var n=[],o=function(e){e.color&&e.title&&(t._names[e.color]=e.title),n.push.apply(n,e.symbols.map((function(t){return{name:t,color:e.color,serverColor:e.color}})))},r=0,l=e;r<l.length;r++){o(l[r])}var a=Object(i.ensureNotNull)(t._service),c=a.store,u=a.actions,h=e.filter((function(t){return 0===t.symbols.length})).map((function(t){return Object(s.__assign)(Object(s.__assign)({},t),{symbols:[]})}));c.dispatch(u.setSymbolLists(h)),C.logNormal("Sync symbols");var f=new Set(t._symbols.keys());n.forEach((function(e){var n=t._symbols.get(e.name)||null,o=n&&n.color!==e.color,r=null===n&&e.color;(o||r)&&t._onChange(e,n,!1),f.delete(e.name)})),f.forEach((function(e){var n=t._symbols.get(e);n&&null!==n.color&&t._onChange({name:e,color:null,serverColor:null},n,!1)})),t._onListChange(!0)})).catch((function(t){throw C.logError("Sync symbols error: "+t.message),t}))},t.prototype.flushChanges=function(){var t,e=this,n=this._getChangedSymbols();this._changed.clear(),t=n.length>0?this._handleSymbols(n):Promise.resolve([]);for(var o=0,r=Array.from(this._symbols.entries());o<r.length;o++){var s=r[o],i=s[0],l=s[1];this._symbols.set(i,{name:l.name,color:l.color,serverColor:l.color})}return t.then((function(t){return C.logNormal("Flush changes"),t})).catch((function(t){return C.logError("Flush changes error: "+t.message),Object(b.a)("marked-symbols"),e.syncSymbols(),[]}))},t.prototype.clear=function(){this._symbols.clear(),this._clearStore(),C.logNormal("Clear")},t.prototype.connect=function(){this._subscribeOnCrossTabEvent(),this._subscribeOnPushStream()},t.prototype.closeConnection=function(){this._unsubscribeOnCrossTabEvent(),this._unsubscribeOnPushStream()},t.prototype._ensureConsistency=function(t){var e=this;t=t.filter((function(t){return null!==t.color})).sort((function(t,e){return S.indexOf(Object(i.ensureNotNull)(t.color))-S.indexOf(Object(i.ensureNotNull)(e.color))}));for(var n=function(){for(var e=new Map,n=0,o=t;n<o.length;n++){var r=o[n],s=Object(i.ensureNotNull)(r.color);e.set(s,new Set(r.symbols))}return e}(),o=new Set,r=new Map,s=new Map,l=function(t,e){return t.has(e)||t.set(e,new Set),Object(i.ensureDefined)(t.get(e))},a=0,c=Array.from(n.entries());a<c.length;a++)for(var u=c[a],h=u[0],f=u[1],m=0,d=Array.from(f);m<d.length;m++){var y=d[m];o.has(y)&&(l(r,h).add(y),f.delete(y)),Object(_.k)(y)===y&&l(s,h).add(y),o.add(y)}for(var b=function(t,e,n){return n?{color:t,before:e,after:n.pro_name||e}:{color:t,before:e,after:e}},p=[],g=function(t,n){if(0===n.size)return"continue";C.logNormal("Marked consistency: resolving suspicious symbols in "+t+" list - "+Array.from(n)),p.push(Promise.all(Array.from(n).map((function(n){return e._session.snapshot(n).then((function(e){return b(t,n,e)})).catch((function(){return b(t,n)}))}))))},v=0,O=Array.from(s.entries());v<O.length;v++){var j=O[v];g(h=j[0],j[1])}return Promise.all(p).then((function(s){for(var i=new Map,a=0,c=s;a<c.length;a++)for(var u=0,h=c[a];u<h.length;u++){var f=h[u];if(f.after!==f.before){
var m=l(n,f.color);m.delete(f.before),l(r,f.color).add(f.before),o.has(f.after)||(o.add(f.after),m.add(f.after),l(i,f.color).add(f.after))}}0!==r.size&&C.logNormal("Marked consistency: removing symbols from "+r.size+" lists");for(var d=0,y=Array.from(r.entries());d<y.length;d++){var b=y[d],p=b[0],g=b[1];e._api.removeSymbols(p,Array.from(g))}0!==i.size&&C.logNormal("Marked consistency: appending resolved symbols to "+r.size+" lists");for(var _=0,v=Array.from(i.entries());_<v.length;_++){var S=v[_],O=(p=S[0],S[1]);e._api.addSymbols(p,Array.from(O))}for(var j=function(e,n){var o=t.find((function(t){return t.color===e}));o&&(o.symbols=Array.from(n))},w=0,L=Array.from(n.entries());w<L.length;w++){var A=L[w];j(p=A[0],g=A[1])}return t}))},t.prototype._handleSymbols=function(t){for(var e=new Map,n=new Map,o=function(t,e){return t.has(e)||t.set(e,new Set),Object(i.ensureDefined)(t.get(e))},r=0,s=t;r<s.length;r++){var l=s[r];if(l.color)o(e,l.color).add(l.name);else if(l.serverColor)o(n,l.serverColor).add(l.name)}for(var a=[],c=0,u=Array.from(e.entries());c<u.length;c++){var h=u[c],f=h[0],m=h[1];a.push(this._api.addSymbols(f,Array.from(m)))}for(var d=0,y=Array.from(n.entries());d<y.length;d++){var b=y[d];f=b[0],m=b[1];a.push(this._api.removeSymbols(f,Array.from(m)))}return Promise.all(a)},t.prototype._setSymbolColor=function(t,e){var n=this._symbols.get(t)||null,o={name:t,color:e,serverColor:n?n.serverColor:null};(n&&n.color!==o.color||!n&&o.color)&&this._onChange(o,n,!0)},t.prototype._onChange=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!0),this._addSymbolToList(t.name,t.color,e&&e.color),this._collectDiffByColor(t.name,t.color,e&&e.color),this._symbols.set(t.name,t),n&&this._changed.add(t.name),this._opts.onSymbolChange&&this._opts.onSymbolChange({name:t.name,color:t.color},e?{name:e.name,color:e.color}:null)},t.prototype._onListChange=function(t){void 0===t&&(t=!1),this._diff.size&&(this._opts.onListChange&&this._opts.onListChange(this._diff),t||f.TVXWindowEvents.emit("ListChanged",JSON.stringify(this._getChangedSymbols())),this._diff.clear())},t.prototype._addSymbolToList=function(t,e,n){if(null!==this._service){var o=this._service,r=o.store,i=o.actions;if(e){if((a=new Set(this.getSymbolsByColor(e))).has(t))return;if(500===a.size)throw C.logNormal("LimitReached"),new Error("LimitReached");a.add(t);var l=this._ensureColoredList(e);r.dispatch(i.addOrUpdateSymbolList(Object(s.__assign)(Object(s.__assign)({},l),{symbols:Array.from(a)})))}if(n){var a;(a=new Set(this.getSymbolsByColor(n))).delete(t);l=this._ensureColoredList(n);r.dispatch(i.addOrUpdateSymbolList(Object(s.__assign)(Object(s.__assign)({},l),{symbols:Array.from(a)})))}}},t.prototype._ensureColoredList=function(t){var e=Object(i.ensureNotNull)(this._service).store.getState();return Object(g.k)(e,t)||Object(_.c)(t,this._names[t])},t.prototype._collectDiffByColor=function(t,e,n){if(e!==n){var o,r;if(e)if(o=this._diff.get(e))o.set(t,1);else(r=new Map).set(t,1),this._diff.set(e,r);if(n)if(o=this._diff.get(n))o.set(t,-1);else(r=new Map).set(t,-1),
this._diff.set(n,r)}},t.prototype._getChangedSymbols=function(){var t=this,e=[];return this._changed.forEach((function(n){var o=t._symbols.get(n);o&&e.push(o)})),e},t.prototype._clearStore=function(){if(null!==this._service){var t=this._service,e=t.store,n=t.actions,o=e.getState(),r=S.map((function(t){return Object(g.k)(o,t)})).filter((function(t){return Boolean(t)})).map((function(t){return Object(s.__assign)(Object(s.__assign)({},t),{symbols:[]})}));e.dispatch(n.setSymbolLists(r))}},t.prototype._subscribeOnCrossTabEvent=function(){f.TVXWindowEvents.on("ListChanged",this._onCrossTabChange)},t.prototype._unsubscribeOnCrossTabEvent=function(){f.TVXWindowEvents.off("ListChanged",this._onCrossTabChange)},t.prototype._subscribeOnPushStream=function(){d.a.on("marked-symbols",this._onPushStreamChange),d.a.onPrivateStatus(this._onPushStreamStatus)},t.prototype._unsubscribeOnPushStream=function(){d.a.off("marked-symbols",this._onPushStreamChange),d.a.offStatus(this._onPushStreamStatus),clearTimeout(o),O=null},t}(),w=n("JOqt"),L=n("brCa");n.d(e,"a",(function(){return H}));var A=function(){function t(t){var e=this;this._symbolChangeHandlers=new Map,this._listChangeHandlers=[],this._initHandlers=[],this._sync=null,this._inited=!1,this._broadcastOnSymbolChange=function(t,n){var o=e._symbolChangeHandlers.get(t.name);o&&o.forEach((function(e){return e(t,n)}))},this._broadcastOnListChange=function(t){e._listChangeHandlers.forEach((function(e){return e(t)}))},this._flushModelChanges=function(){e._model.flushChanges()},this._onLoginStateChange=function(){var t;e._model.closeConnection(),window.is_authenticated?(e._model.connect(),t=e._syncSymbols()):(e._model.clear(),e._inited=!1,t=Promise.resolve()),t.then(e._fireInit)},this._fireInit=function(){e._initHandlers.forEach((function(t){return t()}))},this._runWithSync=function(t){e._sync?e._sync.then(t):t()},this._model=new j({api:t?t.api:void 0,quoteSession:t?t.quoteSession:void 0,onSymbolChange:this._broadcastOnSymbolChange,onListChange:this._broadcastOnListChange}),this._subscribeLoginStateChange(),this._flushModelChanges=Object(w.debounce)(this._flushModelChanges,2e3),this._syncSymbols().then(this._fireInit)}return t.prototype.getSymbolsByColor=function(t){return this._model.getSymbolsByColor(t)},t.prototype.setSymbolsColor=function(t,e){var n=this;0!==t.length&&this._runWithSync((function(){try{n._model.setSymbolsColor(t,e),n._flushModelChanges()}catch(s){"LimitReached"===s.message&&(n._flushModelChanges(),T||(T=Object(L.createNoticeDialog)({title:N,content:(o=500,r.t("Unable to flag all selected symbols since it exceeds the maximum amount ({0}).").format(o))})).then((function(t){t.on("afterClose",(function(){T=null})),t.open()})))}var o}))},t.prototype.getSymbolColor=function(t){return this._model.getSymbolColor(t)},t.prototype.clearAllSymbolsColor=function(){var t=this;this._runWithSync((function(){t._model.clearAllSymbolsColor(),t._flushModelChanges()}))},t.prototype.mergeSymbolsByColor=function(t,e){var n=this._model.getSymbolsByColor(t),o=n.filter((function(t){
return!e.includes(t)})),r=e.filter((function(t){return!n.includes(t)}));this.setSymbolsColor(o,null),this.setSymbolsColor(r,t)},t.prototype.onSymbolChange=function(t,e){var n=this._symbolChangeHandlers.get(t);n?n.push(e):this._symbolChangeHandlers.set(t,[e])},t.prototype.offSymbolChange=function(t,e){var n=this._symbolChangeHandlers.get(t);if(n){var o=n.filter((function(t){return t!==e}));o.length>0?this._symbolChangeHandlers.set(t,o):this._symbolChangeHandlers.delete(t)}},t.prototype.onListChange=function(t){this._listChangeHandlers.push(t)},t.prototype.offListChange=function(t){this._listChangeHandlers=this._listChangeHandlers.filter((function(e){return e!==t}))},t.prototype.onInit=function(t){this._initHandlers.push(t)},t.prototype.offInit=function(t){this._initHandlers=this._initHandlers.filter((function(e){return e!==t}))},t.prototype.destroy=function(){this._model.clear(),this._model.closeConnection(),this._unsubscribeLoginStateChange()},t.prototype.isInited=function(){return this._inited},t.prototype._subscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange)},t.prototype._unsubscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.unsubscribe(this,this._onLoginStateChange)},t.prototype._syncSymbols=function(){var t=this;if(window.is_authenticated){this._sync=this._model.syncSymbols();var e=function(){t._sync=null,t._inited=!0};return this._sync.then(e).catch(e)}return Promise.resolve()},t}(),N=r.t("Issue With Flagging"),T=null;var P=null;function H(){return null===P&&(P=new A),P}}}]);